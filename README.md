# Wind Turbine Transformer Detector

åŸºäº Transformer çš„é£åŠ›å‘ç”µæœºç»„ä»¶ç¼ºé™·æ£€æµ‹æ¨¡å‹ã€‚

## é¡¹ç›®ç»“æ„

```
modules/
â”œâ”€â”€ models/
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ backbone.py     # ä¸»å¹²ç½‘ç»œ
â”‚   â”‚   â”œâ”€â”€ fpn.py         # ç‰¹å¾é‡‘å­—å¡”ç½‘ç»œ
â”‚   â”‚   â””â”€â”€ transformer.py  # Transformerç¼–è§£ç å™¨
â”‚   â”œâ”€â”€ heads/
â”‚   â”‚   â””â”€â”€ detection_head.py  # æ£€æµ‹å¤´
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”œâ”€â”€ box_ops.py     # è¾¹ç•Œæ¡†æ“ä½œ
â”‚   â”‚   â””â”€â”€ losses.py      # æŸå¤±å‡½æ•°
â”‚   â””â”€â”€ wind_turbine_detector.py  # ä¸»æ¨¡å‹
```

## æ¨¡å‹æ¶æ„

1. **ä¸»å¹²ç½‘ç»œ (Backbone)**
   - ResNeté£æ ¼çš„ç‰¹å¾æå–å™¨
   - è¾“å‡ºå¤šå°ºåº¦ç‰¹å¾ [P2, P3, P4, P5]

2. **ç‰¹å¾é‡‘å­—å¡”ç½‘ç»œ (FPN)**
   - ç‰¹å¾èåˆå’Œå°ºåº¦å¯¹é½
   - æ¨ªå‘è¿æ¥å’Œè‡ªé¡¶å‘ä¸‹è·¯å¾„

3. **Transformeræ¨¡å—**
   - 6å±‚ç¼–ç å™¨å’Œè§£ç å™¨
   - æ­£å¼¦ä½ç½®ç¼–ç 
   - å¯å­¦ä¹ çš„ç›®æ ‡æŸ¥è¯¢

4. **æ£€æµ‹å¤´**
   - åˆ†ç±»å’Œè¾¹ç•Œæ¡†é¢„æµ‹
   - å¤šå±‚æ„ŸçŸ¥æœºç»“æ„

## å®‰è£…ä¾èµ–

```bash
pip install -r requirements.txt
```

## ä½¿ç”¨æ–¹æ³•

```python
import torch
from modules.models.wind_turbine_detector import WindTurbineDetector

# åˆ›å»ºæ¨¡å‹
model = WindTurbineDetector(
    num_classes=7,  # æ•…éšœç±»åˆ«æ•°é‡
    input_size=640,  # è¾“å…¥å›¾åƒå¤§å°
    fpn_channels=256,  # ç‰¹å¾é€šé“æ•°
    num_queries=100  # ç›®æ ‡æŸ¥è¯¢æ•°é‡
)

# è®­ç»ƒæ¨¡å¼
loss_dict = model((images, targets))

# æ¨ç†æ¨¡å¼
results = model.inference(images)
```

## æ•…éšœç±»åˆ«

1. burning (ç‡ƒçƒ§)
2. crack (è£‚çº¹)
3. deformity (å˜å½¢)
4. dirt (æ±¡å¢)
5. oil (æ¼æ²¹)
6. peeling (å‰¥è½)
7. rusty (é”ˆèš€)

## ç‰¹ç‚¹

1. ç«¯åˆ°ç«¯çš„ç›®æ ‡æ£€æµ‹
2. æ— éœ€NMSåå¤„ç†
3. é€‚åˆå°ç›®æ ‡æ£€æµ‹
4. å…¨å±€ä¿¡æ¯å»ºæ¨¡
5. å¤šå°ºåº¦ç‰¹å¾èåˆ

## ç¯å¢ƒè¦æ±‚

- Python >= 3.7
- PyTorch >= 1.7.0
- torchvision >= 0.8.1

## é¡¹ç›®ç‰¹ç‚¹

- ğŸš€ è½»é‡çº§ç½‘ç»œè®¾è®¡
- ğŸ¯ ä¸“æ³¨äº7ç±»å¸¸è§æ•…éšœæ£€æµ‹
- ğŸ” é›†æˆå¼ºåŒ–å­¦ä¹ æ³¨æ„åŠ›æœºåˆ¶
- ğŸ“ˆ å®æ—¶è®­ç»ƒç›‘æ§å’Œå¯è§†åŒ–
- ğŸ’¾ å®Œæ•´çš„æ¨¡å‹ä¿å­˜å’ŒåŠ è½½æœºåˆ¶

## ç›®å½•ç»“æ„

```
project/
â”œâ”€â”€ modules/                    # æ ¸å¿ƒæ¨¡å—ç›®å½•
â”‚   â”œâ”€â”€ attention/             # æ³¨æ„åŠ›æœºåˆ¶æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ spatial_attention.py
â”‚   â”‚   â””â”€â”€ reinforce_attention.py
â”‚   â”œâ”€â”€ models/                # æ¨¡å‹å®šä¹‰æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ yolo_transformer.py
â”‚   â”œâ”€â”€ data/                  # æ•°æ®å¤„ç†æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ dataset.py
â”‚   â””â”€â”€ utils/                 # å·¥å…·å‡½æ•°æ¨¡å—
â”œâ”€â”€ config/                    # é…ç½®æ–‡ä»¶ç›®å½•
â”‚   â””â”€â”€ wind-farm.yaml        # ä¸»é…ç½®æ–‡ä»¶
â”œâ”€â”€ datasets/                  # æ•°æ®é›†ç›®å½•
â”‚   â””â”€â”€ Wind-farm/
â”‚       â”œâ”€â”€ train/
â”‚       â”‚   â”œâ”€â”€ images/
â”‚       â”‚   â””â”€â”€ labels/
â”‚       â”œâ”€â”€ val/
â”‚       â”‚   â”œâ”€â”€ images/
â”‚       â”‚   â””â”€â”€ labels/
â”‚       â””â”€â”€ test/
â”‚           â”œâ”€â”€ images/
â”‚           â””â”€â”€ labels/
â”œâ”€â”€ runs/                      # è®­ç»ƒè¾“å‡ºç›®å½•
â”‚   â””â”€â”€ train/
â”‚       â””â”€â”€ YYYYMMDD-HHMMSS/  # è®­ç»ƒç»“æœç›®å½•
â”‚           â”œâ”€â”€ best.pt       # æœ€ä½³æ¨¡å‹
â”‚           â”œâ”€â”€ last.pt       # æœ€æ–°æ¨¡å‹
â”‚           â”œâ”€â”€ results.png   # è®­ç»ƒæ›²çº¿å›¾
â”‚           â”œâ”€â”€ cfg.yaml      # é…ç½®å¤‡ä»½
â”‚           â””â”€â”€ results.yaml  # è®­ç»ƒç»“æœ
â”œâ”€â”€ train.py                  # è®­ç»ƒè„šæœ¬
â”œâ”€â”€ requirements.txt          # é¡¹ç›®ä¾èµ–
â””â”€â”€ README.md                 # é¡¹ç›®è¯´æ˜
```

## å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒé…ç½®

```bash
# åˆ›å»ºcondaç¯å¢ƒ
conda create -n transformer python=3.8
conda activate transformer

# å®‰è£…ä¾èµ–
pip install -r requirements.txt
```

### 2. æ•°æ®å‡†å¤‡

å°†æ•°æ®é›†æŒ‰ä»¥ä¸‹ç»“æ„ç»„ç»‡ï¼š
```
datasets/Wind-farm/
â”œâ”€â”€ train/
â”‚   â”œâ”€â”€ images/    # è®­ç»ƒå›¾åƒ
â”‚   â””â”€â”€ labels/    # è®­ç»ƒæ ‡ç­¾
â”œâ”€â”€ val/
â”‚   â”œâ”€â”€ images/    # éªŒè¯å›¾åƒ
â”‚   â””â”€â”€ labels/    # éªŒè¯æ ‡ç­¾
â””â”€â”€ test/
    â”œâ”€â”€ images/    # æµ‹è¯•å›¾åƒ
    â””â”€â”€ labels/    # æµ‹è¯•æ ‡ç­¾
```

æ ‡ç­¾æ ¼å¼ï¼šæ¯è¡Œä¸€ä¸ªæ ‡ç­¾ï¼Œæ ¼å¼ä¸º `class_id`ï¼ˆ0-6çš„æ•´æ•°ï¼‰

### 3. é…ç½®ä¿®æ”¹

æ ¹æ®éœ€è¦ä¿®æ”¹ `config/wind-farm.yaml` ä¸­çš„å‚æ•°ï¼š

```yaml
model:
  name: "WindTurbineNet"
  num_classes: 7
  input_size: 640

train:
  epochs: 100
  batch: 32
  lr0: 0.001
  momentum: 0.9
  weight_decay: 0.0001
  patience: 20
  save: true
  save_period: 5
```

### 4. å¼€å§‹è®­ç»ƒ

```bash
python train.py --cfg config/wind-farm.yaml
```

### 5. è®­ç»ƒç›‘æ§

è®­ç»ƒè¿‡ç¨‹ä¸­ä¼šåœ¨ `runs/train/` ç›®å½•ä¸‹ç”Ÿæˆå®æ—¶æ›´æ–°çš„ï¼š
- è®­ç»ƒæ›²çº¿å›¾ï¼ˆæŸå¤±å’Œå‡†ç¡®ç‡ï¼‰
- è®­ç»ƒæ—¥å¿—
- æ¨¡å‹æ–‡ä»¶ï¼ˆbest.pt, last.ptï¼‰
- é…ç½®å’Œç»“æœæ–‡ä»¶

## è®­ç»ƒç»“æœ

è®­ç»ƒå®Œæˆåï¼Œåœ¨ `runs/train/YYYYMMDD-HHMMSS/` ç›®å½•ä¸‹å¯ä»¥æ‰¾åˆ°ï¼š

1. **æ¨¡å‹æ–‡ä»¶**
   - `best.pt`: éªŒè¯é›†æ€§èƒ½æœ€å¥½çš„æ¨¡å‹
   - `last.pt`: æœ€åä¸€è½®è®­ç»ƒçš„æ¨¡å‹
   - `epoch_N.pt`: å®šæœŸä¿å­˜çš„æ£€æŸ¥ç‚¹

2. **è®­ç»ƒè®°å½•**
   - `results.png`: è®­ç»ƒå’ŒéªŒè¯çš„æŸå¤±ã€å‡†ç¡®ç‡æ›²çº¿
   - `training_log.txt`: è¯¦ç»†çš„è®­ç»ƒæ—¥å¿—
   - `cfg.yaml`: è®­ç»ƒé…ç½®å¤‡ä»½
   - `results.yaml`: æœ€ç»ˆè®­ç»ƒç»“æœç»Ÿè®¡

## æ³¨æ„äº‹é¡¹

1. **æ•°æ®å‡†å¤‡**
   - ç¡®ä¿å›¾åƒæ ¼å¼æ”¯æŒï¼šjpgã€jpegã€pngã€bmp
   - æ ‡ç­¾æ–‡ä»¶éœ€ä¸å›¾åƒåŒåï¼ˆæ‰©å±•åä¸º.txtï¼‰
   - æ ‡ç­¾å€¼å¿…é¡»æ˜¯0-6çš„æ•´æ•°

2. **è®­ç»ƒå»ºè®®**
   - å»ºè®®ä½¿ç”¨GPUè¿›è¡Œè®­ç»ƒ
   - æ ¹æ®GPUæ˜¾å­˜å¤§å°è°ƒæ•´batch_size
   - å¯é€šè¿‡patienceå‚æ•°æ§åˆ¶æ—©åœ
   - å®šæœŸä¿å­˜çš„æ£€æŸ¥ç‚¹å¯ç”¨äºæ–­ç‚¹ç»­è®­

3. **æ€§èƒ½ä¼˜åŒ–**
   - å¯é€šè¿‡è°ƒæ•´å­¦ä¹ ç‡æå‡è®­ç»ƒæ•ˆæœ
   - æ•°æ®å¢å¼ºå‚æ•°å¯æ ¹æ®å®é™…éœ€æ±‚ä¿®æ”¹
   - æ³¨æ„åŠ›æ¨¡å—çš„warmup_roundså‚æ•°å¯è°ƒ

## å¼•ç”¨

å¦‚æœæ‚¨ä½¿ç”¨äº†æœ¬é¡¹ç›®ï¼Œè¯·å¼•ç”¨ï¼š

```bibtex
@software{WindTurbineNet2024,
  title = {WindTurbineNet: é£åŠ›å‘ç”µæœºç»„ä»¶æ•…éšœæ£€æµ‹ç³»ç»Ÿ},
  year = {2024},
  description = {åŸºäºæ·±åº¦å­¦ä¹ çš„é£åŠ›å‘ç”µæœºç»„ä»¶æ•…éšœæ£€æµ‹ç³»ç»Ÿ}
}
``` 